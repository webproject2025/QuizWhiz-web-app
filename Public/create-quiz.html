<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizWhiz+ - Create Quiz</title>
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/create-quiz.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo">
                <h2>Quiz<span>Whiz+</span></h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="dashboard.html">
                            <span class="icon">üìä</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="my-quizzes.html">
                            <span class="icon">üìù</span>
                            <span>My Quizzes</span>
                        </a>
                    </li>
                    <li>
                        <a href="explore.html">
                            <span class="icon">üîç</span>
                            <span>Explore</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="create-quiz.html">
                            <span class="icon">‚ûï</span>
                            <span>Create Quiz</span>
                        </a>
                    </li>
                    <li>
                        <a href="leaderboard.html">
                            <span class="icon">üèÜ</span>
                            <span>Leaderboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#analytics">
                            <span class="icon">üìà</span>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li>
                        <a href="settings.html">
                            <span class="icon">‚öôÔ∏è</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#help">
                    <span class="icon">‚ùì</span>
                    <span>Help Center</span>
                </a>
                <a href="#logout" class="logout-btn">
                    <span class="icon">üö™</span>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <header class="dashboard-header">
                <div class="menu-toggle" id="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Search for quizzes...">
                    <button type="submit">üîç</button>
                </div>
                <div class="header-actions">
                    <div class="notification">
                        <span class="icon">üîî</span>
                        <span class="badge">3</span>
                    </div>
                    <div class="user-profile">
                        <img src="https://via.placeholder.com/40" alt="User Profile">
                        <div class="user-info">
                            <h4>Alex Johnson</h4>
                            <p>Premium Member</p>
                        </div>
                        <span class="dropdown-icon">‚ñº</span>
                    </div>
                </div>
            </header>

            <div class="dashboard-content">
                <div class="welcome-banner">
                    <div class="welcome-text">
                        <h1>Create a New Quiz</h1>
                        <p>Design your own quiz with custom questions and share it with the community.</p>
                    </div>
                    <div class="quick-actions">
                        <a href="#templates" class="btn btn-outline">Use Template</a>
                        <a href="#import" class="btn btn-outline">Import Questions</a>
                    </div>
                </div>

                <div class="steps-container">
                    <div class="step-item completed">
                        <div class="step-number">1</div>
                        <div class="step-title">Basic Info</div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">2</div>
                        <div class="step-title">Questions</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-title">Settings</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-title">Preview</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">5</div>
                        <div class="step-title">Publish</div>
                    </div>
                </div>

                <form id="quizForm" method="POST" action="create-quiz.php" enctype="multipart/form-data">
                    
                    <div class="form-section">
                        <h2 class="form-section-title">Basic Information</h2>
                        <input type="hidden" name="quiz_id" id="quiz_id">
                        
                        <div class="form-group">
                            <label for="quiz_title">Quiz Title</label>
                            <input type="text" id="quiz_title" name="quiz_title" class="form-input" placeholder="Enter a catchy title for your quiz" value="Science Quiz: Exploring the Natural World" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="quiz_description">Description</label>
                            <textarea id="quiz_description" name="quiz_description" class="form-textarea" placeholder="Describe what your quiz is about" required>Test your knowledge of various scientific concepts, from biology and chemistry to physics and astronomy. This quiz covers a wide range of topics in the natural sciences.</textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label for="quiz_category">Category</label>
                                <select id="quiz_category" name="quiz_category" class="form-select" required>
                                    <option value="">Select a category</option>
                                    <option value="science" selected>Science</option>
                                    <option value="history">History</option>
                                    <option value="math">Mathematics</option>
                                    <option value="literature">Literature</option>
                                    <option value="geography">Geography</option>
                                    <option value="technology">Technology</option>
                                    <option value="arts">Arts</option>
                                    <option value="sports">Sports</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label for="quiz_difficulty">Difficulty Level</label>
                                <select id="quiz_difficulty" name="quiz_difficulty" class="form-select" required>
                                    <option value="">Select difficulty</option>
                                    <option value="easy">Easy</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="hard">Hard</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="quiz_cover">Cover Image</label>
                            <div class="image-upload">
                                <div class="upload-icon">üì∑</div>
                                <p class="upload-text">Drag and drop an image here, or click to browse</p>
                                <input type="file" id="quiz_cover" name="quiz_cover" accept="image/*" style="display: none;">
                                <label for="quiz_cover" class="upload-btn">
                                    Browse Files
                                </label>
                            </div>
                            <p class="form-hint">Recommended size: 1200 x 630 pixels. Max file size: 5MB.</p>
                            <div class="image-preview-container" id="coverPreview" style="display: none;">
                                <img src="#" alt="Cover Preview" class="image-preview">
                                <button type="button" class="btn btn-outline remove-image-btn">Remove Image</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Questions Section -->
                    <div class="form-section">
                        <h2 class="form-section-title">Questions</h2>
                        <div class="questions-container" id="questionsContainer">
                            <!-- Question 1 -->
                            <div class="question-card" data-question-id="question_1">
                                <div class="question-header">
                                    <span class="question-number">Question 1</span>
                                    <div class="question-actions">
                                        <button type="button" class="question-action-btn delete-btn">üóëÔ∏è</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="question-1-text">Question Text</label>
                                    <input type="text" id="question-1-text" class="question-text form-input" value="What is the chemical symbol for gold?" required>
                                </div>
                                <div class="form-group">
                                    <label>Options (select the correct answer)</label>
                                    <div class="options-container">
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_1" value="0" class="option-radio" checked>
                                            <input type="text" class="option-input form-input" value="Au" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_1" value="1" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Ag" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_1" value="2" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Fe" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_1" value="3" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Gd" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                    </div>
                                    <button type="button" class="add-option-btn">+ Add Option</button>
                                </div>
                                <div class="form-group">
                                    <label for="question-1-explanation">Explanation (Optional)</label>
                                    <textarea id="question-1-explanation" class="explanation-text form-textarea">Au is the chemical symbol for gold, derived from the Latin word 'aurum'.</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Question Image (Optional)</label>
                                    <input type="file" class="question-image-input" name="question_image_0" accept="image/*" style="display: none;">
                                    <button type="button" class="btn btn-outline upload-image-btn">Upload Image</button>
                                    <div class="image-preview-container" style="display: none;">
                                        <img class="image-preview" src="#" alt="Preview" style="max-width: 200px; max-height: 150px; margin-top: 10px;">
                                        <button type="button" class="btn btn-outline remove-image-btn" style="margin-top: 5px;">Remove Image</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Question 2 -->
                            <div class="question-card" data-question-id="question_2">
                                <div class="question-header">
                                    <span class="question-number">Question 2</span>
                                    <div class="question-actions">
                                        <button type="button" class="question-action-btn delete-btn">üóëÔ∏è</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="question-2-text">Question Text</label>
                                    <input type="text" id="question-2-text" class="question-text form-input" value="Which planet is known as the Red Planet?" required>
                                </div>
                                <div class="form-group">
                                    <label>Options (select the correct answer)</label>
                                    <div class="options-container">
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_2" value="0" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Venus" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_2" value="1" class="option-radio" checked>
                                            <input type="text" class="option-input form-input" value="Mars" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_2" value="2" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Jupiter" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_2" value="3" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Saturn" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                    </div>
                                    <button type="button" class="add-option-btn">+ Add Option</button>
                                </div>
                                <div class="form-group">
                                    <label for="question-2-explanation">Explanation (Optional)</label>
                                    <textarea id="question-2-explanation" class="explanation-text form-textarea">Mars is known as the Red Planet due to its reddish appearance, which is caused by iron oxide (rust) on its surface.</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Question Image (Optional)</label>
                                    <input type="file" class="question-image-input" name="question_image_1" accept="image/*" style="display: none;">
                                    <button type="button" class="btn btn-outline upload-image-btn">Upload Image</button>
                                    <div class="image-preview-container" style="display: none;">
                                        <img class="image-preview" src="#" alt="Preview" style="max-width: 200px; max-height: 150px; margin-top: 10px;">
                                        <button type="button" class="btn btn-outline remove-image-btn" style="margin-top: 5px;">Remove Image</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Question 3 -->
                            <div class="question-card" data-question-id="question_3">
                                <div class="question-header">
                                    <span class="question-number">Question 3</span>
                                    <div class="question-actions">
                                        <button type="button" class="question-action-btn delete-btn">üóëÔ∏è</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="question-3-text">Question Text</label>
                                    <input type="text" id="question-3-text" class="question-text form-input" value="What is the process by which plants make their own food using sunlight?" required>
                                </div>
                                <div class="form-group">
                                    <label>Options (select the correct answer)</label>
                                    <div class="options-container">
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_3" value="0" class="option-radio" checked>
                                            <input type="text" class="option-input form-input" value="Photosynthesis" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_3" value="1" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Respiration" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_3" value="2" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Transpiration" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                        <div class="option-row">
                                            <input type="radio" name="correct_option_question_3" value="3" class="option-radio">
                                            <input type="text" class="option-input form-input" value="Germination" required>
                                            <button type="button" class="option-delete">‚úï</button>
                                        </div>
                                    </div>
                                    <button type="button" class="add-option-btn">+ Add Option</button>
                                </div>
                                <div class="form-group">
                                    <label for="question-3-explanation">Explanation (Optional)</label>
                                    <textarea id="question-3-explanation" class="explanation-text form-textarea">Photosynthesis is the process by which green plants and some other organisms use sunlight to synthesize foods with carbon dioxide and water, generating oxygen as a byproduct.</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Question Image (Optional)</label>
                                    <input type="file" class="question-image-input" name="question_image_2" accept="image/*" style="display: none;">
                                    <button type="button" class="btn btn-outline upload-image-btn">Upload Image</button>
                                    <div class="image-preview-container" style="display: none;">
                                        <img class="image-preview" src="#" alt="Preview" style="max-width: 200px; max-height: 150px; margin-top: 10px;">
                                        <button type="button" class="btn btn-outline remove-image-btn" style="margin-top: 5px;">Remove Image</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="add-question-btn" id="addQuestionBtn">+ Add New Question</button>
                    </div>
                    
                    <!-- Quiz Settings Section -->
                    <div class="form-section">
                        <h2 class="form-section-title">Quiz Settings</h2>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="time_limit">Time Limit</label>
                                <select id="time_limit" name="time_limit" class="form-select">
                                    <option value="0">No Time Limit</option>
                                    <option value="5">5 minutes</option>
                                    <option value="10" selected>10 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="20">20 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label for="passing_score">Passing Score (%)</label>
                                <select id="passing_score" name="passing_score" class="form-select">
                                    <option value="50">50%</option>
                                    <option value="60">60%</option>
                                    <option value="70" selected>70%</option>
                                    <option value="80">80%</option>
                                    <option value="90">90%</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Quiz Options</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="randomize_questions" name="randomize_questions" checked>
                                    <label for="randomize_questions">Randomize Questions</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="randomize_options" name="randomize_options" checked>
                                    <label for="randomize_options">Randomize Options</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="show_correct_answers" name="show_correct_answers" checked>
                                    <label for="show_correct_answers">Show Correct Answers After Completion</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="show_explanations" name="show_explanations" checked>
                                    <label for="show_explanations">Show Explanations</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="allow_retakes" name="allow_retakes" checked>
                                    <label for="allow_retakes">Allow Retakes</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Privacy Settings</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="privacy" id="privacy_public" value="public" checked>
                                    <label for="privacy_public">Public (Anyone can take this quiz)</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="privacy" id="privacy_unlisted" value="unlisted">
                                    <label for="privacy_unlisted">Unlisted (Only accessible via link)</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="privacy" id="privacy_private" value="private">
                                    <label for="privacy_private">Private (Only you can access)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <div class="form-actions-left">
                            <button type="button" class="btn btn-outline">Save as Draft</button>
                            <button type="button" class="btn btn-outline">Preview</button>
                        </div>
                        <div class="form-actions-right">
                            <button type="button" class="btn btn-outline">Back</button>
                            <button type="submit" class="btn btn-primary">Create Quiz</button>
                        </div>
                    </div>
                </form>
                
                <!-- Preview Section -->
                <div class="preview-section">
                    <div class="preview-header">
                        <h2 class="preview-title">Quiz Preview</h2>
                        <button type="button" class="btn btn-outline">Full Screen Preview</button>
                    </div>
                    <div class="preview-quiz">
                        <h2 class="preview-quiz-title">Science Quiz: Exploring the Natural World</h2>
                        <p class="preview-quiz-description">Test your knowledge of various scientific concepts, from biology and chemistry to physics and astronomy. This quiz covers a wide range of topics in the natural sciences.</p>
                        <div class="preview-quiz-meta">
                            <span>üìö Category: Science</span>
                            <span>üîÑ Difficulty: Medium</span>
                            <span>‚è±Ô∏è Time Limit: 10 minutes</span>
                            <span>‚ùì Questions: 3</span>
                        </div>
                        <div class="preview-question">
                            <p class="preview-question-text">1. What is the chemical symbol for gold?</p>
                            <div class="preview-options">
                                <div class="preview-option">
                                    <span class="preview-option-letter">A</span>
                                    <span>Au</span>
                                </div>
                                <div class="preview-option">
                                    <span class="preview-option-letter">B</span>
                                    <span>Ag</span>
                                </div>
                                <div class="preview-option">
                                    <span class="preview-option-letter">C</span>
                                    <span>Fe</span>
                                </div>
                                <div class="preview-option">
                                    <span class="preview-option-letter">D</span>
                                    <span>Gd</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Menu toggle functionality
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close sidebar when clicking outside (on mobile)
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 992) {
                    if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                        sidebar.classList.remove('active');
                        menuToggle.classList.remove('active');
                    }
                }
            });

            // Cover image preview functionality
            const coverInput = document.getElementById('quiz_cover');
            const coverPreview = document.getElementById('coverPreview');
            
            if (coverInput) {
                coverInput.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            coverPreview.querySelector('img').src = e.target.result;
                            coverPreview.style.display = 'block';
                        }
                        reader.readAsDataURL(this.files[0]);
                    }
                });
                
                const removeImageBtn = coverPreview.querySelector('.remove-image-btn');
                if (removeImageBtn) {
                    removeImageBtn.addEventListener('click', function() {
                        coverInput.value = '';
                        coverPreview.style.display = 'none';
                    });
                }
            }

            // Form submission handler
            const quizForm = document.getElementById('quizForm');
            if (quizForm) {
                quizForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Validate form
                    if (!validateForm()) {
                        return;
                    }
                    
                    // Show loading state
                    const submitBtn = quizForm.querySelector('button[type="submit"]');
                    const originalBtnText = submitBtn.textContent;
                    submitBtn.textContent = 'Creating Quiz...';
                    submitBtn.disabled = true;

                    try {
                        const formData = new FormData(quizForm);
                        
                        // Collect questions data
                        const questions = [];
                        document.querySelectorAll('.question-card').forEach((questionCard, index) => {
                            const questionText = questionCard.querySelector('.question-text').value;
                            const options = [];
                            let correctOption = -1;
                            
                            questionCard.querySelectorAll('.option-row').forEach((optionRow, optionIndex) => {
                                options.push({
                                    text: optionRow.querySelector('.option-input').value
                                });
                                
                                if (optionRow.querySelector('.option-radio').checked) {
                                    correctOption = optionIndex;
                                }
                            });
                            
                            const explanation = questionCard.querySelector('.explanation-text')?.value || '';
                            
                            questions.push({
                                text: questionText,
                                options: options,
                                correct_option: correctOption,
                                explanation: explanation
                            });
                        });
                        
                        // Convert questions to JSON string and append to form data
                        formData.append('questions', JSON.stringify(questions));
                        
                        // Test connection to server first
                        try {
                            const testResponse = await fetch('create-quiz.php', {
                                method: 'GET'
                            });
                            
                            if (!testResponse.ok) {
                                throw new Error(`Server responded with status: ${testResponse.status}`);
                            }
                            
                            console.log('Server connection test successful');
                        } catch (testError) {
                            console.error('Server connection test failed:', testError);
                            throw new Error('Cannot connect to server. Please check your network connection.');
                        }
                        
                        // Submit form
                        const response = await fetch('create-quiz.php', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Server responded with status: ${response.status}`);
                        }
                        
                        const responseText = await response.text();
                        console.log('Raw response:', responseText);
                        
                        let result;
                        try {
                            result = JSON.parse(responseText);
                        } catch (jsonError) {
                            console.error('Failed to parse JSON response:', responseText);
                            throw new Error('Invalid response from server');
                        }
                        
                        if (result.status === 'success') {
                            alert('Quiz created successfully!');
                            window.location.href = 'my-quizzes.html?quiz_id=' + result.quiz_id;
                        } else {
                            throw new Error(result.message || 'Failed to create quiz');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error: ' + error.message);
                    } finally {
                        submitBtn.textContent = originalBtnText;
                        submitBtn.disabled = false;
                    }
                });
            }
            
            function validateForm() {
                // Basic validation
                const title = document.getElementById('quiz_title').value.trim();
                if (!title) {
                    alert('Please enter a quiz title');
                    return false;
                }
                
                const category = document.getElementById('quiz_category').value;
                if (!category) {
                    alert('Please select a category');
                    return false;
                }
                
                const difficulty = document.getElementById('quiz_difficulty').value;
                if (!difficulty) {
                    alert('Please select a difficulty level');
                    return false;
                }
                
                // Validate questions
                const questions = document.querySelectorAll('.question-card');
                if (questions.length === 0) {
                    alert('Please add at least one question');
                    return false;
                }
                
                for (let i = 0; i < questions.length; i++) {
                    const questionText = questions[i].querySelector('.question-text').value.trim();
                    if (!questionText) {
                        alert(`Question ${i+1} is missing text`);
                        return false;
                    }
                    
                    const options = questions[i].querySelectorAll('.option-input');
                    for (let j = 0; j < options.length; j++) {
                        if (!options[j].value.trim()) {
                            alert(`Question ${i+1}, Option ${j+1} is missing text`);
                            return false;
                        }
                    }
                }
                
                return true;
            }

            // Add question button functionality
            const addQuestionBtn = document.getElementById('addQuestionBtn');
            const questionsContainer = document.getElementById('questionsContainer');
            
            if (addQuestionBtn && questionsContainer) {
                addQuestionBtn.addEventListener('click', function() {
                    const questionCount = document.querySelectorAll('.question-card').length + 1;
                    const questionId = 'question_' + Date.now();
                    
                    const newQuestion = document.createElement('div');
                    newQuestion.className = 'question-card';
                    newQuestion.dataset.questionId = questionId;
                    
                    newQuestion.innerHTML = `
                        <div class="question-header">
                            <span class="question-number">Question ${questionCount}</span>
                            <div class="question-actions">
                                <button type="button" class="question-action-btn delete-btn">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Question Text</label>
                            <input type="text" class="question-text form-input" required>
                        </div>
                        <div class="form-group">
                            <label>Options (select the correct answer)</label>
                            <div class="options-container">
                                <div class="option-row">
                                    <input type="radio" name="correct_option_${questionId}" value="0" class="option-radio" checked>
                                    <input type="text" class="option-input form-input" required>
                                    <button type="button" class="option-delete">‚úï</button>
                                </div>
                                <div class="option-row">
                                    <input type="radio" name="correct_option_${questionId}" value="1" class="option-radio">
                                    <input type="text" class="option-input form-input" required>
                                    <button type="button" class="option-delete">‚úï</button>
                                </div>
                            </div>
                            <button type="button" class="add-option-btn">+ Add Option</button>
                        </div>
                        <div class="form-group">
                            <label>Explanation (Optional)</label>
                            <textarea class="explanation-text form-textarea"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Question Image (Optional)</label>
                            <input type="file" class="question-image-input" name="question_image_${questionCount-1}" accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-outline upload-image-btn">Upload Image</button>
                            <div class="image-preview-container" style="display: none;">
                                <img class="image-preview" src="#" alt="Preview" style="max-width: 200px; max-height: 150px; margin-top: 10px;">
                                <button type="button" class="btn btn-outline remove-image-btn" style="margin-top: 5px;">Remove Image</button>
                            </div>
                        </div>
                    `;
                    
                    questionsContainer.appendChild(newQuestion);
                    setupQuestionEventListeners(newQuestion);
                });
            }

            // Setup event listeners for a question card
            function setupQuestionEventListeners(questionCard) {
                // Delete question button
                const deleteBtn = questionCard.querySelector('.delete-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        if (confirm('Are you sure you want to delete this question?')) {
                            questionCard.remove();
                            updateQuestionNumbers();
                        }
                    });
                }

                // Add option button
                const addOptionBtn = questionCard.querySelector('.add-option-btn');
                const optionsContainer = questionCard.querySelector('.options-container');
                
                if (addOptionBtn && optionsContainer) {
                    addOptionBtn.addEventListener('click', function() {
                        const optionCount = optionsContainer.querySelectorAll('.option-row').length;
                        const questionId = questionCard.dataset.questionId;
                        
                        if (optionCount >= 6) {
                            alert('Maximum 6 options allowed per question');
                            return;
                        }
                        
                        const newOption = document.createElement('div');
                        newOption.className = 'option-row';
                        newOption.innerHTML = `
                            <input type="radio" name="correct_option_${questionId}" value="${optionCount}" class="option-radio">
                            <input type="text" class="option-input form-input" required>
                            <button type="button" class="option-delete">‚úï</button>
                        `;
                        
                        optionsContainer.appendChild(newOption);
                        
                        // Add delete event to new option
                        newOption.querySelector('.option-delete').addEventListener('click', function() {
                            if (optionsContainer.querySelectorAll('.option-row').length > 2) {
                                newOption.remove();
                            } else {
                                alert('A question must have at least 2 options.');
                            }
                        });
                    });
                }

                // Image upload functionality
                const imageInput = questionCard.querySelector('.question-image-input');
                const uploadBtn = questionCard.querySelector('.upload-image-btn');
                const previewContainer = questionCard.querySelector('.image-preview-container');
                const previewImage = questionCard.querySelector('.image-preview');
                const removeImageBtn = questionCard.querySelector('.remove-image-btn');

                if (imageInput && uploadBtn) {
                    uploadBtn.addEventListener('click', function() {
                        imageInput.click();
                    });

                    imageInput.addEventListener('change', function() {
                        if (this.files && this.files[0]) {
                            const file = this.files[0];
                            
                            // Validate file type
                            const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
                            if (!validTypes.includes(file.type)) {
                                alert('Please select a valid image file (JPEG, PNG, GIF)');
                                return;
                            }
                            
                            // Validate file size (max 5MB)
                            if (file.size > 5 * 1024 * 1024) {
                                alert('Image must be less than 5MB');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                previewImage.src = e.target.result;
                                previewContainer.style.display = 'block';
                                uploadBtn.style.display = 'none';
                            }
                            reader.readAsDataURL(file);
                        }
                    });
                }

                if (removeImageBtn) {
                    removeImageBtn.addEventListener('click', function() {
                        imageInput.value = '';
                        previewContainer.style.display = 'none';
                        uploadBtn.style.display = 'block';
                    });
                }

                // Delete option buttons
                questionCard.querySelectorAll('.option-delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const optionsContainer = this.closest('.options-container');
                        if (optionsContainer.querySelectorAll('.option-row').length > 2) {
                            this.closest('.option-row').remove();
                        } else {
                            alert('A question must have at least 2 options.');
                        }
                    });
                });
            }

            // Update question numbers after deletion
            function updateQuestionNumbers() {
                document.querySelectorAll('.question-card').forEach((card, index) => {
                    card.querySelector('.question-number').textContent = `Question ${index + 1}`;
                    // Update the question image input name to maintain correct indexing
                    const imageInput = card.querySelector('.question-image-input');
                    if (imageInput) {
                        imageInput.name = `question_image_${index}`;
                    }
                });
            }

            // Initialize existing questions
            document.querySelectorAll('.question-card').forEach(questionCard => {
                setupQuestionEventListeners(questionCard);
            });
        });
    </script>
</body>
</html>
