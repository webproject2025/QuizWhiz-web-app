<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizWhiz+ Dashboard</title>
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    
</head>
<body>
    <div class="dashboard-container">
        <div id="sidebar"></div>
        <main class="main-content">
            <div id="dashboard-header"></div>

            <div id="login-prompt" class="login-prompt" style="display: none;">
                <div class="login-prompt-content">
                    <h2>Please Log In</h2>
                    <p>You need to be logged in to view your dashboard.</p>
                    <a href="login.html" class="btn btn-primary">Log In</a>
                    <p class="signup-prompt">Don't have an account? <a href="signup.html">Sign up</a></p>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="welcome-banner">
                    <div class="welcome-text">
                        <h1>Welcome back, <span id="welcome-email">Loading...</span>!</h1>
                        <p>Continue your learning journey. You've completed 5 quizzes this week.</p>
                    </div>
                    <div class="quick-actions">
                        <a href="explore.html" class="btn btn-outline">Explore Quizzes</a>
                    </div>
                </div>

                <section class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: rgba(108, 99, 255, 0.2);">üìä</div>
                        <div class="stat-details">
                            <h3>Total Quizzes Taken</h3>
                            <p class="stat-number">127</p>
                            <p class="stat-trend positive">‚Üë 12% from last month</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: rgba(245, 0, 87, 0.2);">üéØ</div>
                        <div class="stat-details">
                            <h3>Average Score</h3>
                            <p class="stat-number">78%</p>
                            <p class="stat-trend positive">‚Üë 5% from last month</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: rgba(76, 175, 80, 0.2);">‚è±Ô∏è</div>
                        <div class="stat-details">
                            <h3>Time Spent Learning</h3>
                            <p class="stat-number">42h</p>
                            <p class="stat-trend positive">‚Üë 8% from last month</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: rgba(255, 152, 0, 0.2);">üèÜ</div>
                        <div class="stat-details">
                            <h3>Achievements</h3>
                            <p class="stat-number">18/30</p>
                            <p class="stat-trend">2 new this month</p>
                        </div>
                    </div>
                </section>

                <section class="progress-section">
                    <div class="section-header">
                        <h2>Your Learning Progress</h2>
                        <a href="#view-all" class="view-all">View All</a>
                    </div>
                    <div class="progress-container">
                        <div class="progress-card">
                            <div class="progress-info">
                                <h3>Science Master</h3>
                                <p>Track: Advanced Physics</p>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: 75%;">
                                    <span class="progress-text">75%</span>
                                </div>
                            </div>
                            <a href="#continue" class="btn btn-sm">Continue</a>
                        </div>
                        <div class="progress-card">
                            <div class="progress-info">
                                <h3>History Explorer</h3>
                                <p>Track: World War II</p>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: 45%;">
                                    <span class="progress-text">45%</span>
                                </div>
                            </div>
                            <a href="#continue" class="btn btn-sm">Continue</a>
                        </div>
                        <div class="progress-card">
                            <div class="progress-info">
                                <h3>Math Genius</h3>
                                <p>Track: Calculus Fundamentals</p>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: 90%;">
                                    <span class="progress-text">90%</span>
                                </div>
                            </div>
                            <a href="#continue" class="btn btn-sm">Continue</a>
                        </div>
                    </div>
                </section>

                <div class="two-column-layout">
                    <section class="recent-quizzes">
                        <div class="section-header">
                            <h2>Recent Quizzes</h2>
                            <a href="#view-all" class="view-all">View All</a>
                        </div>
                        <div class="quiz-list">
                            <div class="quiz-item">
                                <div class="quiz-info">
                                    <h3>Quantum Physics Basics</h3>
                                    <p>Last attempt: Yesterday</p>
                                    <div class="quiz-meta">
                                        <span>Score: 85%</span>
                                        <span>Time: 12min</span>
                                    </div>
                                </div>
                                <a href="#retry" class="btn btn-sm">Retry</a>
                            </div>
                            <div class="quiz-item">
                                <div class="quiz-info">
                                    <h3>World Geography Challenge</h3>
                                    <p>Last attempt: 3 days ago</p>
                                    <div class="quiz-meta">
                                        <span>Score: 92%</span>
                                        <span>Time: 15min</span>
                                    </div>
                                </div>
                                <a href="#retry" class="btn btn-sm">Retry</a>
                            </div>
                            <div class="quiz-item">
                                <div class="quiz-info">
                                    <h3>Literary Classics</h3>
                                    <p>Last attempt: 1 week ago</p>
                                    <div class="quiz-meta">
                                        <span>Score: 78%</span>
                                        <span>Time: 20min</span>
                                    </div>
                                </div>
                                <a href="#retry" class="btn btn-sm">Retry</a>
                            </div>
                            <div class="quiz-item">
                                <div class="quiz-info">
                                    <h3>Computer Science 101</h3>
                                    <p>Last attempt: 2 weeks ago</p>
                                    <div class="quiz-meta">
                                        <span>Score: 95%</span>
                                        <span>Time: 18min</span>
                                    </div>
                                </div>
                                <a href="#retry" class="btn btn-sm">Retry</a>
                            </div>
                        </div>
                    </section>

                    <section class="recommended-quizzes">
                        <div class="section-header">
                            <h2>Recommended For You</h2>
                            <a href="#view-all" class="view-all">View All</a>
                        </div>
                        <div class="recommended-list">
                            <div class="recommended-item">
                                <img src="/placeholder.svg?height=80&width=120" alt="Astronomy Quiz">
                                <div class="recommended-info">
                                    <h3>Astronomy: Stars and Galaxies</h3>
                                    <div class="quiz-details">
                                        <span>25 questions</span>
                                        <span>‚Ä¢</span>
                                        <span>Intermediate</span>
                                    </div>
                                    <div class="quiz-creator">
                                        <img src="/placeholder.svg?height=20&width=20" alt="Creator">
                                        <span>By Science Academy</span>
                                    </div>
                                </div>
                                <a href="#start" class="btn btn-sm">Start</a>
                            </div>
                            <div class="recommended-item">
                                <img src="/placeholder.svg?height=80&width=120" alt="Music Theory Quiz">
                                <div class="recommended-info">
                                    <h3>Music Theory Fundamentals</h3>
                                    <div class="quiz-details">
                                        <span>30 questions</span>
                                        <span>‚Ä¢</span>
                                        <span>Beginner</span>
                                    </div>
                                    <div class="quiz-creator">
                                        <img src="/placeholder.svg?height=20&width=20" alt="Creator">
                                        <span>By Music Institute</span>
                                    </div>
                                </div>
                                <a href="#start" class="btn btn-sm">Start</a>
                            </div>
                            <div class="recommended-item">
                                <img src="/placeholder.svg?height=80&width=120" alt="Coding Quiz">
                                <div class="recommended-info">
                                    <h3>JavaScript Algorithms</h3>
                                    <div class="quiz-details">
                                        <span>20 questions</span>
                                        <span>‚Ä¢</span>
                                        <span>Advanced</span>
                                    </div>
                                    <div class="quiz-creator">
                                        <img src="/placeholder.svg?height=20&width=20" alt="Creator">
                                        <span>By Code Masters</span>
                                    </div>
                                </div>
                                <a href="#start" class="btn btn-sm">Start</a>
                            </div>
                        </div>
                    </section>
                </div>

                <section class="achievements-section">
                    <div class="section-header">
                        <h2>Recent Achievements</h2>
                        <a href="#view-all" class="view-all">View All</a>
                    </div>
                    <div class="achievements-container">
                        <div class="achievement-card">
                            <div class="achievement-icon">üèÖ</div>
                            <div class="achievement-info">
                                <h3>Perfect Score</h3>
                                <p>Achieved 100% on a quiz</p>
                            </div>
                            <span class="achievement-date">2 days ago</span>
                        </div>
                        <div class="achievement-card">
                            <div class="achievement-icon">üî•</div>
                            <div class="achievement-info">
                                <h3>5-Day Streak</h3>
                                <p>Completed quizzes for 5 consecutive days</p>
                            </div>
                            <span class="achievement-date">Yesterday</span>
                        </div>
                        <div class="achievement-card">
                            <div class="achievement-icon">‚ö°</div>
                            <div class="achievement-info">
                                <h3>Speed Demon</h3>
                                <p>Completed a quiz in record time</p>
                            </div>
                            <span class="achievement-date">1 week ago</span>
                        </div>
                        <div class="achievement-card">
                            <div class="achievement-icon">üß†</div>
                            <div class="achievement-info">
                                <h3>Knowledge Seeker</h3>
                                <p>Completed quizzes in 10 different categories</p>
                            </div>
                            <span class="achievement-date">2 weeks ago</span>
                        </div>
                    </div>
                </section>

                <section class="friends-activity">
                    <div class="section-header">
                        <h2>Friends Activity</h2>
                        <a href="#view-all" class="view-all">View All</a>
                    </div>
                    <div class="friends-container">
                        <div class="friend-card">
                            <img src="/placeholder.svg?height=50&width=50" alt="Sarah">
                            <div class="friend-info">
                                <h3>Sarah Johnson</h3>
                                <p>Completed "Advanced Biology" with 92%</p>
                            </div>
                            <span class="activity-time">2h ago</span>
                        </div>
                        <div class="friend-card">
                            <img src="/placeholder.svg?height=50&width=50" alt="Mike">
                            <div class="friend-info">
                                <h3>Mike Chen</h3>
                                <p>Created a new quiz: "Coding Challenges"</p>
                            </div>
                            <span class="activity-time">5h ago</span>
                        </div>
                        <div class="friend-card">
                            <img src="/placeholder.svg?height=50&width=50" alt="Emma">
                            <div class="friend-info">
                                <h3>Emma Wilson</h3>
                                <p>Earned "Knowledge Master" achievement</p>
                            </div>
                            <span class="activity-time">Yesterday</span>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Load shared sidebar and header, then fetch user
        function loadComponent(id, url, callback) {
            fetch(url).then(r => r.text()).then(html => {
                document.getElementById(id).innerHTML = html;
                if (callback) callback();
            });
        }

        async function fetchHeaderUser() {
            try {
                const response = await fetch('/QuizWhiz-web-app/api/get_current_user.php', { credentials: 'include' });
                const data = await response.json();
                if (response.ok && data.user && data.user.email) {
                    document.getElementById('user-email').textContent = data.user.email;
                    document.getElementById('welcome-email').textContent = data.user.email;
                } else {
                    document.getElementById('user-email').textContent = 'Not logged in';
                    document.getElementById('welcome-email').textContent = 'Guest';
                }
            } catch (e) {
                console.error('Error fetching user data:', e);
                document.getElementById('user-email').textContent = 'Not logged in';
                document.getElementById('welcome-email').textContent = 'Guest';
            }
        }

        // Fetch dashboard data
        async function fetchDashboardData() {
            try {
                const response = await fetch('/QuizWhiz-web-app/api/get_dashboard_data.php', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (response.ok && data) {
                    // Update dashboard stats
                    updateDashboardStats(data);
                } else {
                    console.error('Failed to fetch dashboard data:', data.error);
                }
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats(data) {
            // Update stats if available
            if (data.stats) {
                // Update total quizzes
                if (data.stats.total_quizzes) {
                    document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = data.stats.total_quizzes;
                }
                // Update average score
                if (data.stats.average_score) {
                    document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = data.stats.average_score + '%';
                }
                // Update time spent
                if (data.stats.time_spent) {
                    document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = data.stats.time_spent + 'h';
                }
                // Update achievements
                if (data.stats.achievements) {
                    document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = data.stats.achievements;
                }
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadComponent('sidebar', '/QuizWhiz-web-app/components/sidebar.html', function() {
                // Wait for sidebar to load before adding event listeners
                const menuToggle = document.getElementById('menu-toggle');
                const sidebar = document.querySelector('.sidebar');
                
                if (menuToggle && sidebar) {
                    menuToggle.addEventListener('click', function() {
                        sidebar.classList.toggle('active');
                        menuToggle.classList.toggle('active');
                    });

                    // Close sidebar when clicking outside on mobile
                    document.addEventListener('click', function(event) {
                        if (window.innerWidth <= 992) {
                            if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                                sidebar.classList.remove('active');
                                menuToggle.classList.remove('active');
                            }
                        }
                    });
                }
            });
            
            loadComponent('dashboard-header', '/QuizWhiz-web-app/components/header.html', fetchHeaderUser);
            fetchDashboardData();
        });
    </script>
</body>
</html>
